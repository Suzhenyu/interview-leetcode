### myisam和innodb的区别是什么

答者：狸追

innodb 支持事务和外键，最小锁粒度是行级锁

myisam 不支持事务和外键，最小锁粒度是表级锁，间歇锁

补充

innodb 的索引如果是聚簇索引，叶子节点上保存的是数据和索引，非聚簇索引，节点上保存的是id，而myisam保存的是数据的地址（相当于一个指针）

myisam 的表可以没有索引，innodb一定要有索引

myisam 会保存总行数，innodb是全表扫描

对于大量更新、插入、删除，innodb性能上更好，因为他具备的事务、行级锁、B+树等特点，更安全，因为回滚和崩溃恢复更适合大型应用

经过测试在单进程读的情况下myisam执行速度比innodb更快，但是多进程读的时候就失去优势了

mysql5.5版本之后默认innodb

### 聚簇索引是什么？二级索引的数据结构是什么？

索引按照数据结构来说主要包含B+树和Hash索引。

聚簇索引：用B+树保存，节点只包含id索引，叶子节点同时保存索引和数据，这种数据和索引在一起的方式就是聚簇索引，有主键使用主键，没有主键就用唯一非空索引代替，如果没有会隐式定义一个主键，一张表只能有一个聚簇索引

非聚簇索引：又称二级索引，保存的是主键id值，这一点和myisam保存的是数据地址是不同的。

为什么要分库分表？

- 数据量达到几千万时查询时间变多，无论表级锁还是行级锁，联合查询大概率阻塞严重(索引膨胀、查询超时)
- 对于大表要进行表结构DDL几乎不可能
- 从Innodb本身来讲数据文件的Btree上只有两个锁, 叶子节点锁和子节点锁,可以想而知道,当发生页拆分或是添加新叶时都会造成表里不能写入数据

#### 多久分一个表

- 大数据量并且访问频繁的表，应该拆分成多个表
- 经测试在单表1000万条记录以下，写入读取性能是比较好的，再留点buffer,那么单表全是数据字型的保持在800万条记录以下, 有字符型的单表保持在500万以下。
- 最好是提前规划预估表数据量，方便做分页查询，减少数据清洗

#### 多久分一个库？

- 单台数据库服务器存储空间、cpu、内存、网络io等因素无法支撑，做水平拆分（分库）

#### 用什么做分库分表？

使用mycat做分库分表，现在金融级别的分布式数据库可以考虑使用tidb，对水平伸缩和数据一致性有保证

#### 分表策略（水平拆分）

- 查询切分（不推荐），把ID和库的Mapping关系记录在一个单独的库中，又会引入新的单点压力问题
- 范围切分，按照id范围切分，单表大小可控，但集中写入会频繁操作单表
- Hash切分，易于水平扩展,例如：mod 32, 拆分32个库，每个库 div 32 mod 32 拆分32张表，就是`32*32=1024`张表，更多参考`(32*2^n)*(32⁄2^n)`
- 其他业务相关：地理位置、时间

引用 [大众点评订单系统分库分表实践 - 美团技术团队](https://tech.meituan.com/2016/11/18/dianping-order-db-sharding.html)

#### 垂直分库

把不同的表放在不同的库，不同的库放在不同服务器上，但是联合查询无法从数据库层面做到

#### 怎么跨表查询，还有排序和翻页怎么做的？
issue

#### 分库分表有什么缺点？怎么解决？

- 联合查询困难，关联的表可能不在同一数据库中
- 避免在同一个事务中修改不同库中的表，操作复杂，效率也会有影响
- 尽量把同一数据放在同一db服务器上，单点故障时不会影响其他数据

#### select count(*) conunt(1)和count(字段)执行的效率有何不同？

1. count(primary key)。遍历整个表，把主键值拿出来，累加；
2. count(1)。遍历整个表，但是不取值，累加；
3. count(非空字段)。遍历整个表，读出这个字段，累加；
4. count(可以为空的字段)。遍历整个表，读出这个字段，判断不为null累加；
5. count(*)。遍历整个表，做了优化，不取值，累加。

来自 [胡慢慢滚雪球](https://www.zhihu.com/question/34781415/answer/767552025)

### 最后

如果文中有误，欢迎提pr或者issue，**一旦合并或采纳作为贡献奖励可以联系我直接无门槛**加入[技术交流群](https://mp.weixin.qq.com/s/ErQFjJbIsMVGjIRWbQCD1Q)

我是小熊，关注我，知道更多不知道的技术

![](https://coding3min.oss-accelerate.aliyuncs.com/2021/03/11/gQDiQ51116.jpg)